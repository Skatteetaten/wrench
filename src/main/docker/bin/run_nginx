#!/bin/sh
PROCESSED_CONF=$(mktemp)
export RESOLVER=$(grep nameserver /etc/resolv.conf | head -n 1 | awk '{print $2}')
envsubst '${PROXY_PASS_HOST}${PROXY_PASS_PORT}${RESOLVER}${OIDC_CLIENT}${OIDC_SECRET}${OIDC_DISCOVERY}${OIDC_PID}${BIGBIRD_DISCOVERY}' < /etc/nginx/nginx.conf > $PROCESSED_CONF && \
mv $PROCESSED_CONF /etc/nginx/nginx.conf && \
exec /usr/local/openresty/bin/openresty -c '/etc/nginx/nginx.conf' -g 'daemon off;' 
